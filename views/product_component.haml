:javascript
  if(!window.jQuery)
  {
     var script = document.createElement('script');
     script.type = "text/javascript";
     script.src = "https://code.jquery.com/jquery-3.1.1.min.js";
     document.getElementsByTagName('script')[0].appendChild( script );
  }

%template#product-template
  .product
    .url{:style=>"display: none;"}product
    %h1.name
    .actions


:javascript
  (function (){
   var currentScript = document.currentScript;
   var template = currentScript
            .ownerDocument
            .getElementById('product-template')
            .content
    customElements.define('product-view',
    class extends HTMLElement {
      constructor() {
        super()
        }
      connectedCallback() {
        var temp = document.importNode(template, true);
        this.appendChild(temp);
        var url=this.getAttribute('url')
        this.querySelector('.url').innerHTML=url
        var view=this;
        $.getJSON(url).done(function(data) {
                        view.querySelector('.name').innerHTML=data.name;
                      })
                      .fail(function() {
                          view.querySelector('.name').innerHTML="Error";
                        });
        var addAction=function (urltemplate)
        {
          var actionurl=urltemplate.replace("{product}",url)
          var actionElement=document.createElement("div");

          $.get(actionurl, function( data ) {
               actionElement.innerHTML= data;
            view.querySelector('.actions').appendChild(actionElement)
              });

        }
         #{actions.map do |action|  "addAction (\""+action+"\")"  end.join ';'}
    }
  })
  }())

